let r=[],a=0;const c=4;let p=0,g=e=>{let i=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},lc:0,listen(n){return t.lc=i.push(n),()=>{for(let s=a+c;s<r.length;)r[s]===n?r.splice(s,c):s+=c;let l=i.indexOf(n);~l&&(i.splice(l,1),--t.lc||t.off())}},notify(n,l){p++;let s=!r.length;for(let u of i)r.push(u,t.value,n,l);if(s){for(a=0;a<r.length;a+=c)r[a](r[a+1],r[a+2],r[a+3]);r.length=0}},off(){},set(n){let l=t.value;l!==n&&(t.value=n,t.notify(l))},subscribe(n){let l=t.listen(n);return n(t.value),l},value:e};return t};const L=5,d=6,h=10;let N=(e,i,t,n)=>(e.events=e.events||{},e.events[t+h]||(e.events[t+h]=n(l=>{e.events[t].reduceRight((s,u)=>(u(s),s),{shared:{},...l})})),e.events[t]=e.events[t]||[],e.events[t].push(i),()=>{let l=e.events[t],s=l.indexOf(i);l.splice(s,1),l.length||(delete e.events[t],e.events[t+h](),delete e.events[t+h])}),x=1e3,M=(e,i)=>N(e,n=>{let l=i(n);l&&e.events[d].push(l)},L,n=>{let l=e.listen;e.listen=(...u)=>(!e.lc&&!e.active&&(e.active=!0,n()),l(...u));let s=e.off;return e.events[d]=[],e.off=()=>{s(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let u of e.events[d])u();e.events[d]=[]}},x)},()=>{e.listen=l,e.off=s}}),R=(e,i,t)=>{Array.isArray(e)||(e=[e]);let n,l,s=()=>{if(l===p)return;l=p;let v=e.map(f=>f.get());if(!n||v.some((f,o)=>f!==n[o])){n=v;let f=i(...v);f&&f.then&&f.t?f.then(o=>{n===v&&u.set(o)}):(u.set(f),l=p)}},u=g(void 0),O=u.get;u.get=()=>(s(),O());let U=s;return M(u,()=>{let v=e.map(f=>f.listen(U));return s(),()=>{for(let f of v)f()}}),u},_=(e,i)=>R(e,i);var E=g(null),T=g("en");_([E,T],(e,i)=>e??i);var m=g({});function A(e,i){E.set(e),T.set(e),i&&m.set(i)}function I(e){m.set(e)}export{A as i,I as s};
